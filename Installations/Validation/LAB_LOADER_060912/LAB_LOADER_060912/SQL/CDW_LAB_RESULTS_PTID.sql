
SET TIME OFF
SET HEADING ON
SET LINESIZE 140
SET PAGESIZE 52
SET TRIMOUT OFF
SET TRIMSPOOL OFF
SET PAUSE OFF
SET WRAP OFF
SET ECHO OFF
SET DOCUMENT OFF
SET VERIFY OFF
SET SHOW OFF
SET FEEDBACK OFF
SET ARRAYSIZE 15
SET NUMWIDTH 10

COLUMN today            NOPRINT NEW_VALUE     datevar


COLUMN 	PATIENT_ID			HEADING "PTID"			FORMAT A10
COLUMN 	RECORD_DATETIME			HEADING "RECORD DATETIME"	FORMAT A17
COLUMN 	REPORTED_DATETIME		HEADING "REPORTED DATETIME"	FORMAT A17
COLUMN 	RECEIVED_DATETIME		HEADING "RECEIVED DATETIME"	FORMAT A17
COLUMN 	COLLECTED_DATETIME		HEADING "COLLECTED DATETIME"	FORMAT A18
COLUMN 	INSERTED_DATETIME		HEADING "INSERTED DATETIME"	FORMAT A17
COLUMN 	LOAD_FLAG			HEADING "LOAD FLAG"		FORMAT A9
COLUMN 	LOAD_DATE			HEADING "LOAD DATE"		FORMAT A10
COLUMN 	RECS				HEADING "# RECORDS"		



SELECT TO_CHAR(SYSDATE,'DD-MON-YY HH:MI:SS AM') today FROM DUAL;

ACCEPT PTID PROMPT "Enter Patient ID: "

SPOOL CDW_LAB_RESULTS_&PTID;

DEFINE studytitle =  "LAB_LOADER - CDW_LAB_RESULTS - count - &&PTID"
DEFINE filename = "File: CDW_LAB_RESULTS_PTID"
DEFINE Progname = "SQl script: CDW_LAB_RESULTS_PTID.SQL"
TTITLE LEFT 'User: ' SQL.USER CENTER studytitle RIGHT datevar SKIP 2
BTITLE LEFT filename          CENTER progname   RIGHT 'Page:' FORMAT 09 SQL.PNO 

Select distinct 
  PATIENT_ID,
  RECORD_DATETIME,
  REPORTED_DATETIME,
  RECEIVED_DATETIME,
  COLLECTED_DATETIME,
  INSERTED_DATETIME,
  LOAD_FLAG,
  LOAD_DATE,
  count(TEST_NAME) RECS
from CDW_LAB_RESULTS
WHERE PATIENT_ID = '&PTID'
GROUP BY
  PATIENT_ID,
  RECORD_DATETIME,
  REPORTED_DATETIME,
  RECEIVED_DATETIME,
  COLLECTED_DATETIME,
  INSERTED_DATETIME,
  LOAD_FLAG,
  LOAD_DATE
ORDER BY
  PATIENT_ID,
  RECORD_DATETIME,
  REPORTED_DATETIME,
  RECEIVED_DATETIME,
  COLLECTED_DATETIME,
  INSERTED_DATETIME,
  LOAD_FLAG,
  LOAD_DATE;

SPOOL OFF;

CLEAR COLUMNS

